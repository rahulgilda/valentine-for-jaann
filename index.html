<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Will you be my valentine?</title>

    <style>
      :root{
        --bg1:#f7c6d9;
        --bg2:#f2b9cf;
        --card:#ffffffee;
        --text:#1f1f1f;
        --muted:#6b6b6b;
        --yes:#d81b60;
        --yesHover:#c2185b;
        --no:#e9e9ee;
        --shadow: 0 18px 40px rgba(0,0,0,.12);
        --panel:#ffd7e7;
        --tile:#ffeaf2;
      }

      *{box-sizing:border-box}
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
        color:var(--text);
        min-height:100vh;
        display:grid;
        place-items:center;
        background:
          radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.55), transparent 55%),
          radial-gradient(900px 600px at 90% 30%, rgba(255,255,255,.35), transparent 60%),
          linear-gradient(180deg, var(--bg1), var(--bg2));
        overflow-y: auto;
        overflow-x: hidden;
      }

      .photoFrame{
        width: 100%;
        max-width: 420px;
        margin: 14px auto 0;
        border-radius: 16px;
        overflow: hidden;
        background: #f3f3f3;
        box-shadow: 0 14px 26px rgba(0,0,0,.12);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .photoFrame img{
        width: 100%;
        height: auto;
        max-height: 420px;
        object-fit: contain;
        display: block;
      }

      .wrap{
        width:min(720px, 92vw);
        padding:28px 0;
        display:grid;
        place-items:center;
      }

      .card{
        width:min(720px, 92vw);
        border-radius:18px;
        background:var(--card);
        box-shadow:var(--shadow);
        padding:40px 34px 30px;
        text-align:center;
        position:relative;
        overflow:hidden;
        backdrop-filter: blur(6px);
      }

      .topIcon{
        width: auto;
        max-width: 220px;
        margin: 0 auto 16px;
        display:flex;
        justify-content:center;
      }
      .topImg{
        width:100%;
        height:auto;
        max-width:200px;
        object-fit:contain;
        display:block;
      }

      h1{
        margin:8px 0 18px;
        font-size: clamp(22px, 3.2vw, 34px);
        line-height:1.1;
        letter-spacing:-.02em;
        font-weight:900;
      }

      .buttonsArea{
        position:relative;
        height:86px;
        margin:8px auto 6px;
        width:min(420px, 90%);
        display:flex;
        align-items:center;
        justify-content:center;
        gap:22px;
      }

      button{
        border:0;
        cursor:pointer;
        font-weight:900;
        transition: transform .12s ease, background .12s ease, box-shadow .12s ease, opacity .12s ease;
        user-select:none;
      }

      .yesBtn{
        --yesScale: 1;
        background:var(--yes);
        color:white;
        padding:14px 28px;
        border-radius:999px;
        font-size:20px;
        box-shadow: 0 14px 24px rgba(216,27,96,.25);
        min-width:116px;
        transform: scale(var(--yesScale));
      }
      .yesBtn:hover{
        background:var(--yesHover);
        transform: translateY(-1px) scale(calc(var(--yesScale) * 1.02));
        box-shadow: 0 16px 26px rgba(216,27,96,.28);
      }

      .noBtn{
        --noScale: 1;
        background:var(--no);
        color:#3a3a3a;
        padding:10px 18px;
        border-radius:999px;
        font-size:14px;
        min-width:70px;
        box-shadow: 0 10px 18px rgba(0,0,0,.10);
        position:absolute;
        right:80px;
        top:22px;
        transform: scale(var(--noScale));
      }

      .hint{
        margin:12px 0 0;
        color:#000;
        font-size:18px;
        font-weight:900;
        letter-spacing:0.3px;
      }

      .noMessage{
        display:none;
        width:min(360px, 92%);
        margin:14px auto 0;
        padding:12px 12px 10px;
        border-radius:14px;
        background:rgba(0,0,0,.04);
        box-shadow: 0 14px 30px rgba(0,0,0,.10);
      }
      .noMessage .title{
        font-weight:900;
        font-size:18px;
        margin:2px 0 6px;
      }
      .noMessage .sub{
        font-weight:800;
        color:rgba(0,0,0,.65);
        font-size:13px;
        margin:0 0 10px;
      }
      .noMessage img{
        width:100%;
        display:block;
        border-radius:12px;
        box-shadow: 0 14px 30px rgba(0,0,0,.14);
        background:#fff;
      }

      .success{
        display:none;
        padding:10px 0 0;
      }

      .yay{
        font-size: clamp(30px, 4vw, 44px);
        margin:8px 0 10px;
        font-weight:900;
        letter-spacing:-.03em;
      }

      /* smaller gif box */
      .gif{
        width:min(300px, 86%);
        border-radius:16px;
        overflow:hidden;
        margin:10px auto 10px;
        box-shadow: 0 16px 34px rgba(0,0,0,.16);
        background:#fff;
        display:none;
        animation: pop 0.25s ease-out;
      }
      .gif img{ width:100%; height:auto; display:block; }

      @keyframes pop {
        from { transform: scale(0.92); opacity: 0; }
        to   { transform: scale(1); opacity: 1; }
      }

      .again{
        margin-top:14px;
        background: rgba(0,0,0,.06);
        padding:10px 14px;
        border-radius:999px;
        font-weight:900;
      }
      .again:hover{ transform: translateY(-1px); }

      .primaryCta{
        margin-top: 10px;
        background: rgba(216,27,96,.12);
        padding:12px 16px;
        border-radius: 999px;
        font-weight: 900;
        color: #9c1045;
        box-shadow: 0 12px 24px rgba(216,27,96,.12);
      }
      .primaryCta:hover{ transform: translateY(-1px); }

      .confetti{
        position:absolute;
        inset:0;
        pointer-events:none;
        opacity:0;
      }
      .confetti.on{ opacity:1; }
      .confetti i{
        position:absolute;
        width:10px;
        height:14px;
        border-radius:3px;
        top:-20px;
        animation: fall linear forwards;
        transform: rotate(12deg);
      }
      @keyframes fall{
        to{
          transform: translateY(520px) rotate(280deg);
          opacity:.9;
        }
      }

      .sparkles{
        position:fixed;
        inset:0;
        pointer-events:none;
        opacity:.20;
        background-image:
          radial-gradient(circle at 12% 18%, rgba(255,255,255,.9) 0 2px, transparent 3px),
          radial-gradient(circle at 74% 22%, rgba(255,255,255,.9) 0 2px, transparent 3px),
          radial-gradient(circle at 33% 70%, rgba(255,255,255,.9) 0 2px, transparent 3px),
          radial-gradient(circle at 88% 78%, rgba(255,255,255,.9) 0 2px, transparent 3px),
          radial-gradient(circle at 55% 45%, rgba(255,255,255,.9) 0 1.6px, transparent 3px);
        background-repeat:no-repeat;
      }

      @keyframes shakeHard {
        0% { transform: translate(0,0) rotate(0deg) scale(var(--noScale, 1)); }
        10% { transform: translate(-3px, 2px) rotate(-2deg) scale(var(--noScale, 1)); }
        20% { transform: translate(4px, -2px) rotate(2deg) scale(var(--noScale, 1)); }
        30% { transform: translate(-5px, 1px) rotate(-3deg) scale(var(--noScale, 1)); }
        40% { transform: translate(5px, 3px) rotate(3deg) scale(var(--noScale, 1)); }
        50% { transform: translate(-4px, -3px) rotate(-2deg) scale(var(--noScale, 1)); }
        60% { transform: translate(4px, 2px) rotate(2deg) scale(var(--noScale, 1)); }
        70% { transform: translate(-3px, -2px) rotate(-2deg) scale(var(--noScale, 1)); }
        80% { transform: translate(3px, 1px) rotate(2deg) scale(var(--noScale, 1)); }
        90% { transform: translate(-2px, 2px) rotate(-1deg) scale(var(--noScale, 1)); }
        100% { transform: translate(0,0) rotate(0deg) scale(var(--noScale, 1)); }
      }
      .noBtn.shaking{
        animation: shakeHard 0.25s linear infinite;
        background:#e53935;
        color:#fff;
        box-shadow: 0 0 0 4px rgba(229,57,53,.25);
      }

      .typeCaret::after{
        content:"‚ñã";
        margin-left:2px;
        opacity:1;
        animation: caretBlink 0.8s steps(1, end) infinite;
      }
      @keyframes caretBlink{ 50%{ opacity:0; } }

      .screen{ display:none; }
      .screen.on{ display:block; }

      .giftsPanel{
        margin-top: 12px;
        background: linear-gradient(180deg, rgba(255,215,231,.95), rgba(255,215,231,.70));
        border-radius: 18px;
        padding: 18px 16px 16px;
        box-shadow: 0 18px 36px rgba(0,0,0,.12);
        border: 1px solid rgba(0,0,0,.06);
      }

      .giftsTitle{
        font-size: 28px;
        font-weight: 950;
        margin: 0 0 12px;
        font-family: ui-serif, Georgia, "Times New Roman", serif;
        letter-spacing: -.02em;
      }

      .tiles{
        display:grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 14px;
        margin-top: 14px;
      }
      @media (max-width: 520px){
        .tiles{ grid-template-columns: 1fr; }
      }

      .tile{
        background: rgba(255,255,255,.65);
        border-radius: 16px;
        padding: 12px;
        box-shadow: 0 16px 30px rgba(0,0,0,.10);
        border: 1px solid rgba(0,0,0,.06);
        display:flex;
        flex-direction:column;
        align-items:center;
        gap:10px;
      }

      .tilePreview{
        width: 92px;
        height: 92px;
        border-radius: 16px;
        background: rgba(255,255,255,.8);
        box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
        overflow:hidden;
        display:grid;
        place-items:center;
      }
      .tilePreview img{
        width:100%;
        height:100%;
        object-fit:cover;
        display:block;
      }

      .tileLabel{
        font-weight: 950;
        margin: 0;
        font-size: 14px;
        color: rgba(0,0,0,.75);
      }

      .tileBtn{
        width: 100%;
        padding: 10px 12px;
        border-radius: 999px;
        background: rgba(216,27,96,.12);
        color: #9c1045;
        font-weight: 950;
        box-shadow: 0 12px 22px rgba(216,27,96,.10);
      }
      .tileBtn:hover{ transform: translateY(-1px); background: rgba(216,27,96,.16); }

      .tileBtn:disabled{
        cursor:not-allowed;
        background: rgba(0,0,0,.07);
        color: rgba(0,0,0,.55);
        box-shadow:none;
        transform:none !important;
      }

      .finallyRow{
        margin-top: 14px;
        display:flex;
        justify-content:center;
      }

      .finallyBtn{
        min-width: 160px;
        padding: 11px 18px;
        border-radius: 999px;
        background: #e53935;
        color: white;
        font-weight: 950;
        box-shadow: 0 16px 30px rgba(229,57,53,.22);
      }
      .finallyBtn:hover{ transform: translateY(-1px); }
      .finallyBtn:disabled{
        cursor:not-allowed;
        opacity:.55;
        transform:none !important;
        box-shadow:none;
      }

      .navRow{
        display:flex;
        gap:10px;
        justify-content:center;
        flex-wrap:wrap;
        margin-top: 14px;
      }
      .miniBtn{
        background: rgba(0,0,0,.06);
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 900;
      }
      .miniBtn:hover{ transform: translateY(-1px); }

      .quizBox{
        text-align:left;
        width:min(440px, 100%);
        margin: 0 auto;
        background: rgba(0,0,0,.03);
        border: 1px solid rgba(0,0,0,.06);
        border-radius: 16px;
        padding: 14px 14px 12px;
        box-shadow: 0 14px 26px rgba(0,0,0,.10);
      }
      .qTitle{
        font-weight: 950;
        margin: 2px 0 10px;
        text-align:center;
      }
      .qText{
        font-weight: 900;
        margin: 6px 0 10px;
        line-height: 1.25;
      }
      .opt{
        display:flex;
        gap:10px;
        align-items:flex-start;
        padding: 10px 10px;
        border-radius: 12px;
        background: rgba(255,255,255,.7);
        margin: 8px 0;
        cursor:pointer;
        border: 1px solid rgba(0,0,0,.06);
      }
      .opt input{ margin-top: 2px; }
      .opt span{ font-weight: 900; color: rgba(0,0,0,.80); }

      .feedback{
        margin-top: 10px;
        font-weight: 950;
        text-align:center;
        padding: 10px 12px;
        border-radius: 12px;
        display:none;
      }
      .feedback.bad{ background: rgba(198,40,40,.10); color: #c62828; display:block; }
      .feedback.good{ background: rgba(46,125,50,.12); color: #2e7d32; display:block; }

      .submitBtn{
        width: 100%;
        margin-top: 10px;
        background: var(--yes);
        color:white;
        padding: 12px 14px;
        border-radius: 999px;
        font-weight: 950;
        box-shadow: 0 14px 24px rgba(216,27,96,.20);
      }
      .submitBtn:hover{ background: var(--yesHover); transform: translateY(-1px); }

      .letter{
        text-align:left;
        width:min(460px, 100%);
        margin: 0 auto;
        background: rgba(255,255,255,.8);
        border-radius: 16px;
        padding: 16px 16px 12px;
        border: 1px solid rgba(0,0,0,.06);
        box-shadow: 0 14px 26px rgba(0,0,0,.10);
      }
      .letter p{
        margin: 10px 0;
        font-weight: 800;
        color: rgba(0,0,0,.78);
        line-height: 1.35;
      }
	  
	  /* üíå FINAL LETTER ‚Äî make it BIG & emotional */
		.finalLetter{
		  width: 100%;
		  max-width: 680px;   /* controls how big it can get */
		  margin: 20px auto 10px;
		  padding: 0;
		  background: none;
		  border: none;
		  box-shadow: none;
		}

		.finalLetter img{
		  width: 100%;
		  height: auto;
		  display: block;
		  border-radius: 22px;
		  box-shadow: 0 24px 50px rgba(0,0,0,.22);
		}
		
		/* ‚úÖ ONLY on Finally screen: make top heart/couple image smaller */
		#card[data-screen="screenFinally"] .topImg{
		  max-width: 140px;     /* smaller heart image */
		}

		#card[data-screen="screenFinally"] .topIcon{
		  margin-bottom: 8px;   /* less gap */
		}

/* ‚úÖ FINAL screen ‚Äî clean, no gaps, letter-style */
#card[data-screen="screenFinally"] .finalLetter{
  width: 100%;
  max-width: 460px;   /* narrower = feels taller */
  margin: 10px auto 6px;
  padding: 0;
  background: none;
  border: none;
  box-shadow: none;
}

#card[data-screen="screenFinally"] .finalLetter img{
  width: 100%;
  height: auto;        /* ‚úÖ NO forced height */
  display: block;
  border-radius: 0;    /* sharp edges */
  box-shadow: 0 22px 44px rgba(0,0,0,.22);
}
    </style>
  </head>

  <body>
    <div class="sparkles"></div>

    <main class="wrap">
      <section class="card" id="card">
        <div class="confetti" id="confetti"></div>

        <audio id="yesSound" preload="auto">
          <source src="https://www.myinstants.com/media/sounds/anime-wow-sound-effect.mp3" type="audio/mpeg" />
        </audio>

        <div class="topIcon">
          <img
            src="https://rahulgilda.github.io/valentine-for-jaann/Realistic.png"
            alt="cute icon"
            class="topImg"
          />
        </div>

        <!-- SCREEN: ASK -->
        <div class="screen" id="screenAsk">
          <h1 id="questionText"><span id="name">Neha</span> will you be my valentine?</h1>

          <div class="buttonsArea" id="buttonsArea">
            <button class="yesBtn" id="yesBtn">Yes</button>
            <button class="noBtn" id="noBtn">No</button>
          </div>

          <h2 class="hint" id="hintText">"No" bolke dekhle gadhiüòà</h2>

          <div class="noMessage" id="noMessage">
            <div class="title">I hate you jaaa nikal sharamless ü•∫</div>
            <div class="sub">But you still have an option to say Yes üò≥</div>
            <img
              alt="i hate you gif"
              src="https://rahulgilda.github.io/valentine-for-jaann/angry.gif"
            />
          </div>
        </div>

		<!-- SCREEN: SUCCESS -->
		<div class="screen" id="screenSuccess">
		  <div class="success" id="success">
			<div class="yay">NAMUNI üòò</div>

			<h1 style="margin-top: 8px;">
			  Happy Valentine‚Äôs Day Jaannnn üíò
			</h1>

			<div class="gif" id="gifBox">
			  <video
				autoplay
				loop
				muted
				playsinline
				preload="auto"
				style="width: 100%; max-width: 360px; border-radius: 12px;"
			  >
				<source
				  src="https://rahulgilda.github.io/valentine-for-jaann/0_Couple_Love_1080x1080.mp4"
				  type="video/mp4"
				/>
				Your browser does not support the video tag.
			  </video>
			</div>

			<button class="primaryCta" id="giftsBtn">
			  See my gifts üéÅ
			</button>
			<br />
			<button class="again" id="againBtn">
			  Replay
			</button>
		  </div>
		</div>

        <!-- SCREEN: GIFTS -->
        <div class="screen" id="screenGifts">
          <div class="giftsPanel">
            <div class="giftsTitle">Something for You</div>

            <div class="tiles">
              <div class="tile">
                <div class="tilePreview">
                  <img id="gift1Gif" alt="Gift 1 gif" src="https://rahulgilda.github.io/valentine-for-jaann/yawn.gif" />
                </div>
                <p class="tileLabel">Gift 1</p>
                <button class="tileBtn" id="giftBtn1">Open</button>
              </div>

              <div class="tile">
                <div class="tilePreview">
                  <img id="gift2Gif" alt="Gift 2 gif" src="https://rahulgilda.github.io/valentine-for-jaann/brrr.gif" />
                </div>
                <p class="tileLabel">Gift 2</p>
                <button class="tileBtn" id="giftBtn2" disabled>Locked</button>
              </div>
            </div>

            <div class="finallyRow">
              <button class="finallyBtn" id="finalBtn" disabled>FINALLY ‚Üí</button>
            </div>
          </div>

          <div class="navRow">
            <button class="miniBtn" id="backToSuccessBtn">Back</button>
            <button class="miniBtn" id="resetProgressBtn">Reset gifts</button>
          </div>
        </div>

        <!-- SCREEN: QUIZ (Gift 1) -->
        <div class="screen" id="screenQuiz">
          <h1>Gift 1 üòà</h1>

          <div class="quizBox">
            <div class="qTitle" id="quizTitle">Let‚Äôs play a quiz</div>

            <div class="qText" id="qText">Question goes here</div>

            <label class="opt">
              <input type="radio" name="qOpt" value="A" />
              <span id="optA">A</span>
            </label>

            <label class="opt">
              <input type="radio" name="qOpt" value="B" />
              <span id="optB">B</span>
            </label>

            <label class="opt">
              <input type="radio" name="qOpt" value="C" />
              <span id="optC">C</span>
            </label>

            <div class="feedback" id="quizFeedback"></div>

            <button class="submitBtn" id="quizSubmit">Submit</button>
          </div>

          <!-- ‚úÖ Wrong-answer GIF shown at bottom (different per question) -->
          <div class="gif" id="wrongGif">
            <img id="wrongGifImg" src="" alt="Wrong answer gif" />
          </div>

          <div class="navRow">
            <button class="miniBtn" id="quizBackBtn">Back</button>
          </div>
        </div>

        <!-- SCREEN: LETTER (Gift 2) -->
        <div class="screen" id="screenLetter">
          <h1>Gift 2 üíå</h1>

          <div class="letter">
            <p>
              Jaann‚Ä¶ you make my days softer and my life brighter. I‚Äôm grateful for you ‚Äî for your smile,
              your drama, your love, and even your ‚ÄúNo‚Äù sometimes üò≠
            </p>
            <p>
              I choose you ‚Äî again and again ‚Äî in the small moments and the big ones. You are my favorite person,
              my safe place, and my most beautiful habit. üíï
            </p>
            <p style="font-weight:950;">‚Äî Yours, always üòò</p>

            <div class="photoFrame">
              <img
                src="https://rahulgilda.github.io/valentine-for-jaann/IMG_2430.jpeg"
                alt="Our photo"
              />
            </div>
          </div>

          <div class="navRow">
            <button class="miniBtn" id="markGift2DoneBtn">Done</button>
            <button class="miniBtn" id="letterBackBtn">Back</button>
          </div>
        </div>

        <!-- SCREEN: FINALLY -->
        <div class="screen" id="screenFinally">
          <h1>Finally üíñ</h1>

			<div class="letter finalLetter">
			  <img
				src="https://raw.githubusercontent.com/rahulgilda/valentine-for-jaann/refs/heads/main/Letter.png"
				alt="Love Letter"
			  />
			</div>

          <div class="navRow">
            <button class="miniBtn" id="finallyBackBtn">Back</button>
            <button class="miniBtn" id="finallyReplayBtn">Replay</button>
          </div>
        </div>

      </section>
    </main>

    <script>
      // ================== NAME ==================
      const qs = new URLSearchParams(location.search);
      const name = (qs.get("name") || "Neha").trim();
      document.getElementById("name").textContent = name || "Neha";

      // ================== ELEMENTS ==================
      const card = document.getElementById("card");
      const confetti = document.getElementById("confetti");
      const yesSound = document.getElementById("yesSound");

      const screenAsk = document.getElementById("screenAsk");
      const screenSuccess = document.getElementById("screenSuccess");
      const screenGifts = document.getElementById("screenGifts");
      const screenQuiz = document.getElementById("screenQuiz");
      const screenLetter = document.getElementById("screenLetter");
      const screenFinally = document.getElementById("screenFinally");

      const questionText = document.getElementById("questionText");
      const buttonsArea = document.getElementById("buttonsArea");
      const yesBtn = document.getElementById("yesBtn");
      const noBtn = document.getElementById("noBtn");
      const hintText = document.getElementById("hintText");
      const noMessage = document.getElementById("noMessage");

      const success = document.getElementById("success");
      const gifBox = document.getElementById("gifBox");
      const giftsBtn = document.getElementById("giftsBtn");
      const againBtn = document.getElementById("againBtn");

      const giftBtn1 = document.getElementById("giftBtn1");
      const giftBtn2 = document.getElementById("giftBtn2");
      const finalBtn = document.getElementById("finalBtn");

      const backToSuccessBtn = document.getElementById("backToSuccessBtn");
      const resetProgressBtn = document.getElementById("resetProgressBtn");

      const quizTitle = document.getElementById("quizTitle");
      const qText = document.getElementById("qText");
      const optA = document.getElementById("optA");
      const optB = document.getElementById("optB");
      const optC = document.getElementById("optC");
      const quizFeedback = document.getElementById("quizFeedback");
      const quizSubmit = document.getElementById("quizSubmit");
      const quizBackBtn = document.getElementById("quizBackBtn");

      // ‚úÖ wrong GIF elements
      const wrongGif = document.getElementById("wrongGif");
      const wrongGifImg = document.getElementById("wrongGifImg");

      const letterBackBtn = document.getElementById("letterBackBtn");
      const markGift2DoneBtn = document.getElementById("markGift2DoneBtn");

      const finallyBackBtn = document.getElementById("finallyBackBtn");
      const finallyReplayBtn = document.getElementById("finallyReplayBtn");

      const originalQuestionHTML = questionText.innerHTML;

      // ================== PROGRESS (locks) ==================
      const STORAGE_KEY = "valentine_clean_gifts_v1";
      const defaultProgress = { gift1Done:false, gift2Done:false };

      function loadProgress(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw) return {...defaultProgress};
          const p = JSON.parse(raw);
          return { ...defaultProgress, ...p };
        }catch(e){ return {...defaultProgress}; }
      }
      function saveProgress(p){
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(p)); }catch(e){}
      }
      let progress = loadProgress();

      function renderLocks(){
        giftBtn1.disabled = false;
        giftBtn1.textContent = progress.gift1Done ? "Open again" : "Open";

        const g2Unlocked = progress.gift1Done;
        giftBtn2.disabled = !g2Unlocked;
        giftBtn2.textContent = g2Unlocked ? (progress.gift2Done ? "Open again" : "Open") : "Locked";

        const finallyUnlocked = progress.gift2Done;
        finalBtn.disabled = !finallyUnlocked;
      }

      // ================== SCREEN SWITCHER ==================
      function allScreensOff(){
        [screenAsk, screenSuccess, screenGifts, screenQuiz, screenLetter, screenFinally]
          .forEach(s => s.classList.remove("on"));
      }
		function showScreen(el){
		  allScreensOff();
		  el.classList.add("on");

		  // ‚úÖ add this line so CSS can target the active screen
		  card.setAttribute("data-screen", el.id);
		}
      // ================== CONFETTI + SOUND ==================
      function launchConfetti(){
        confetti.innerHTML = "";
        confetti.classList.add("on");

        const pieces = 80;
        const colors = ["#E91E63","#FFB6C1","#FFD54F","#7E57C2","#29B6F6","#66BB6A","#FF7043","#EC407A"];
        const w = card.clientWidth;

        for(let i=0;i<pieces;i++){
          const p = document.createElement("i");
          const left = Math.random() * w;
          const delay = Math.random() * 0.6;
          const duration = 1.6 + Math.random() * 1.4;

          p.style.left = `${left}px`;
          p.style.background = colors[Math.floor(Math.random()*colors.length)];
          p.style.animationDelay = `${delay}s`;
          p.style.animationDuration = `${duration}s`;
          p.style.opacity = (0.6 + Math.random()*0.4).toFixed(2);

          confetti.appendChild(p);
        }

        setTimeout(() => confetti.classList.remove("on"), 3200);
      }

      function playYesSound(){
        try{
          yesSound.currentTime = 0;
          const p = yesSound.play();
          if(p && typeof p.catch === "function") p.catch(() => {});
        }catch(e){}
      }

      // ================== YOUR EXISTING YES/NO FLOW ==================
      const angryLine = "Tu no click karne ka sochi na abh dekh tu üò°üò≠";
      const stage2HeadingHTML = 'Waapis <strong>NO</strong> kari naüò≠';

      let stage = 1;
      let noAttempts = 0;
      let noTouched = false;
      let noBusy = false;

      function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

      async function typeWriter(el, text, speed = 55){
        el.classList.add("typeCaret");
        el.textContent = "";
        for(let i=0;i<text.length;i++){
          el.textContent += text[i];
          await sleep(speed);
        }
        el.classList.remove("typeCaret");
      }

      function moveNoButton(){
        const area = buttonsArea.getBoundingClientRect();
        const btn = noBtn.getBoundingClientRect();

        const pad = 6;
        const maxX = area.width - btn.width - pad;
        const maxY = area.height - btn.height - pad;

        const x = Math.random() * maxX + pad;
        const y = Math.random() * maxY + pad;

        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
        noBtn.style.right = "auto";
      }

      function setHintForStage(){
        if(stage === 1){
          hintText.textContent = '"No" bolke dekhle gadhiüòà';
        }else{
          hintText.textContent = '"No" waapis bolke dekh kuttiüê∂';
        }
      }

      async function shakeThenRun(){
        if(noBusy) return;
        noBusy = true;

        noTouched = true;

        if(stage === 2){
          yesBtn.style.setProperty("--yesScale", 0.75);
          noBtn.style.setProperty("--noScale", 1.35);

          hintText.style.display = "none";
          questionText.innerHTML = stage2HeadingHTML;

          noMessage.style.display = "block";

          noBtn.classList.add("shaking");
          await sleep(220);
          noBtn.classList.remove("shaking");

          moveNoButton();
          noBusy = false;
          return;
        }

        noAttempts += 1;

        const yesScale = Math.min(1.9, 1 + noAttempts * 0.08);
        const noScale = Math.max(0.55, 1 - noAttempts * 0.07);

        yesBtn.style.setProperty("--yesScale", yesScale);
        noBtn.style.setProperty("--noScale", noScale);

        noBtn.classList.add("shaking");
        await sleep(220);
        noBtn.classList.remove("shaking");

        moveNoButton();
        noBusy = false;
      }

      noBtn.addEventListener("mouseenter", shakeThenRun);
      noBtn.addEventListener("click", shakeThenRun);

      function showFinalSuccess(){
        showScreen(screenSuccess);
        success.style.display = "block";
        gifBox.style.display = "block";
        launchConfetti();
      }

      async function onYesClicked(){
        playYesSound();

        if(stage === 1 && !noTouched){
          showFinalSuccess();
          return;
        }

        if(stage === 1){
          noMessage.style.display = "none";

          await typeWriter(questionText, angryLine, 55);
          await sleep(800);

          questionText.textContent = angryLine;

          yesBtn.style.setProperty("--yesScale", 0.75);
          noBtn.style.setProperty("--noScale", 1.35);

          stage = 2;
          setHintForStage();

          hintText.style.display = "block";
          yesBtn.style.display = "inline-block";
          noBtn.style.display = "inline-block";
          return;
        }

        showFinalSuccess();
      }

      yesBtn.addEventListener("click", onYesClicked);

      // ================== GIFTS FLOW ==================
      giftsBtn.addEventListener("click", () => {
        renderLocks();
        showScreen(screenGifts);
      });

      backToSuccessBtn.addEventListener("click", () => showScreen(screenSuccess));

      resetProgressBtn.addEventListener("click", () => {
        progress = { ...defaultProgress };
        saveProgress(progress);
        renderLocks();
      });

      giftBtn1.addEventListener("click", () => {
        setQuizQuestion(0);
        showScreen(screenQuiz);
      });

      giftBtn2.addEventListener("click", () => {
        showScreen(screenLetter);
      });

      finalBtn.addEventListener("click", () => {
        showScreen(screenFinally);
      });

      // ================== QUIZ (Gift 1) ==================
      const quiz = [
        {
          title: "Let‚Äôs play a quiz üòà",
          q: "Who is the besharam kutti/kutta among us?",
          A: "A. Obviously Me",
          B: "B. You",
          C: "C. Mummy",
          correct: "A",
          // ‚úÖ placeholder gif for wrong answer (update later)
          wrongGifSrc: "https://rahulgilda.github.io/valentine-for-jaann/Wrong answer 1.gif"
        },
        {
          title: "One more üòè",
          q: "Who fights / gaslights among us?",
          A: "A. Always Me",
          B: "B. You",
          C: "C. No one",
          correct: "A",
          // ‚úÖ placeholder gif for wrong answer (update later)
          wrongGifSrc: "https://rahulgilda.github.io/valentine-for-jaann/Wrong answer 2.gif"
        }
      ];
      let quizIndex = 0;

      function hideWrongGif(){
        wrongGif.style.display = "none";
        wrongGifImg.src = "";
      }

      function showWrongGif(src){
        wrongGifImg.src = src;
        wrongGif.style.display = "block";
      }

      function setQuizQuestion(i){
        quizIndex = i;
        const item = quiz[i];

        quizTitle.textContent = item.title;
        qText.textContent = item.q;
        optA.textContent = item.A;
        optB.textContent = item.B;
        optC.textContent = item.C;

        quizFeedback.className = "feedback";
        quizFeedback.style.display = "none";
        quizFeedback.textContent = "";

        // ‚úÖ reset wrong gif for new question
        hideWrongGif();

        document.querySelectorAll('input[name="qOpt"]').forEach(r => r.checked = false);
        quizSubmit.textContent = (i === quiz.length - 1) ? "Finish" : "Next";
      }

      function getSelectedOpt(){
        const el = document.querySelector('input[name="qOpt"]:checked');
        return el ? el.value : null;
      }

      quizSubmit.addEventListener("click", () => {
        const item = quiz[quizIndex];
        const choice = getSelectedOpt();

        if(!choice){
          hideWrongGif();
          quizFeedback.className = "feedback bad";
          quizFeedback.textContent = "Choose an option first jaann üò§";
          quizFeedback.style.display = "block";
          return;
        }

        if(choice !== item.correct){
          // ‚úÖ WRONG: show gif at bottom, hide text
          quizFeedback.style.display = "none";
          showWrongGif(item.wrongGifSrc);
          return;
        }

        // ‚úÖ CORRECT: hide wrong gif, show good feedback
        hideWrongGif();
        quizFeedback.className = "feedback good";
        quizFeedback.textContent = "Correct üòò";
        quizFeedback.style.display = "block";

        setTimeout(() => {
          if(quizIndex < quiz.length - 1){
            setQuizQuestion(quizIndex + 1);
          }else{
            progress.gift1Done = true;
            saveProgress(progress);

            //alert("Now open Gift Box 1üò§üéÅ");
            renderLocks();
            showScreen(screenGifts);
          }
        }, 650);
      });

      quizBackBtn.addEventListener("click", () => {
        hideWrongGif();
        renderLocks();
        showScreen(screenGifts);
      });

      // Gift 2 done -> unlock Finally
      markGift2DoneBtn.addEventListener("click", () => {
        progress.gift2Done = true;
        saveProgress(progress);
        renderLocks();
        showScreen(screenGifts);
      });

      letterBackBtn.addEventListener("click", () => {
        renderLocks();
        showScreen(screenGifts);
      });

      finallyBackBtn.addEventListener("click", () => {
        renderLocks();
        showScreen(screenGifts);
      });

      // ================== REPLAY RESET ==================
      function resetAll(){
        questionText.innerHTML = originalQuestionHTML;

        stage = 1;
        setHintForStage();
        hintText.style.display = "block";

        yesBtn.style.display = "inline-block";
        noBtn.style.display = "inline-block";

        noMessage.style.display = "none";

        noAttempts = 0;
        noTouched = false;

        yesBtn.style.setProperty("--yesScale", 1);
        noBtn.style.setProperty("--noScale", 1);

        noBtn.style.left = "auto";
        noBtn.style.right = "80px";
        noBtn.style.top = "22px";
        noBtn.classList.remove("shaking");

        progress = { ...defaultProgress };
        saveProgress(progress);

        // ‚úÖ cleanup quiz gif too
        hideWrongGif();

        showScreen(screenAsk);
      }

      againBtn.addEventListener("click", resetAll);
      finallyReplayBtn.addEventListener("click", resetAll);

      // ================== BOOT ==================
      function init(){
        showScreen(screenAsk);
        setHintForStage();
        renderLocks();
      }
      init();
    </script>
  </body>
</html>
